<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>ReachCheck Report</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

        @page {
            size: A4;
            margin: 0;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
            color: #333;
            -webkit-font-smoothing: antialiased;
        }

        .page {
            width: 210mm;
            min-height: 297mm;
            padding: 20mm;
            box-sizing: border-box;
            background: white;
            margin: 0 auto;
            position: relative;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        h1,
        h2,
        h3 {
            margin: 0 0 10px 0;
            word-break: keep-all;
        }

        p {
            margin: 0 0 10px 0;
            line-height: 1.6;
            word-break: break-word;
            /* Prevent overflow */
            white-space: pre-wrap;
            /* Visualize \n */
        }

        .header {
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            color: #1a1a1a;
            max-width: 80%;
        }

        .header .date {
            font-size: 12px;
            color: #666;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            border-left: 5px solid #0052cc;
            padding-left: 10px;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        /* Summary Box */
        .summary-box {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .summary-text {
            font-size: 15px;
            line-height: 1.7;
            color: #495057;
        }

        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 11px;
            color: white;
            vertical-align: middle;
        }

        .bg-green {
            background-color: #28a745;
        }

        .bg-yellow {
            background-color: #ffc107;
            color: #333;
        }

        .bg-red {
            background-color: #dc3545;
        }

        .text-match {
            color: #16a34a;
        }

        .text-mismatch {
            color: #dc2626;
        }

        /* Grid */
        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .card {
            border: 1px solid #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            background: #fff;
        }

        .card h4 {
            font-size: 14px;
            margin-bottom: 8px;
            color: #1e293b;
            font-weight: 600;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        th,
        td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: left;
        }

        /* STRICT PRINT STYLES - DO NOT MODIFY WITHOUT A4 VERIFICATION */
        @media print {
            @page {
                size: A4;
                margin: 12mm;
                /* User requested 12mm */
            }

            /* 3) Reset HTML/Body for overflow handling */
            html,
            body {
                width: auto !important;
                height: auto !important;
                overflow: visible !important;
                background: white;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                margin: 0;
                padding: 0;
            }

            /* 2) Constrain the wrapper */
            .print-root {
                width: 180mm;
                max-width: 180mm;
                margin: 0 auto;
                padding: 0;
                /* Fail-safe: Scale down slightly to ensure 180mm fits in any margin variance */
                transform: scale(0.95);
                transform-origin: top center;
            }

            /* 3) Force full width on children */
            .page,
            .container,
            .card,
            .section,
            .summary-box,
            table {
                width: 100% !important;
                max-width: 100% !important;
                box-shadow: none !important;
                border: none !important;
                margin: 0 !important;
                padding: 0 !important;
                box-sizing: border-box !important;
            }

            /* 3.1) Safety for Tables: Force fixed layout to prevent blowout */
            table {
                table-layout: fixed !important;
            }

            /* Re-establish logical page separation */
            .page {
                padding-bottom: 20px !important;
                page-break-after: always;
                break-after: page;
                /* Keep internal padding for readability if needed, but safe to reset if margins handle it */
                padding: 0 !important;
            }

            .page:last-child {
                page-break-after: auto;
            }

            /* 3) Maximize images/tables */
            img,
            table,
            pre,
            code,
            blockquote {
                max-width: 100% !important;
            }

            /* 4) Force word breaks */
            .card,
            .section,
            td,
            p,
            li,
            h1,
            h2,
            h3,
            h4,
            span,
            div,
            th {
                overflow-wrap: anywhere !important;
                word-break: break-word !important;
                white-space: normal !important;
                /* Force wrap for badges too */
            }

            /* Specific workaround for badges to allow wrapping */
            .status-badge,
            .badge,
            .pill {
                white-space: normal !important;
                max-width: 100% !important;
                display: inline-block;
            }

            /* 5) Break rules */
            .card,
            .summary-box,
            table,
            tr,
            .priority-item {
                break-inside: avoid;
                page-break-inside: avoid;
            }

            /* 6) Hide UI */
            button,
            .no-print {
                display: none !important;
            }
        }


        .priority-rank {
            font-size: 11px;
            color: #0052cc;
            font-weight: 800;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .priority-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #1e293b;
        }

        /* Quote */
        .quote-box {
            background: #f1f5f9;
            border-left: 4px solid #334155;
            padding: 25px;
            font-style: italic;
            font-size: 16px;
            line-height: 1.8;
            margin: 30px 0;
            color: #334155;
            font-family: 'Georgia', serif;
        }

        .footer {
            position: absolute;
            bottom: 15mm;
            left: 20mm;
            right: 20mm;
            text-align: center;
            font-size: 10px;
            color: #94a3b8;
            border-top: 1px solid #f1f5f9;
            padding-top: 10px;
        }

        /* Action Summary */
        .action-summary-container {
            background: #fff5f5;
            border: 1px solid #feb2b2;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 30px;
        }

        .warning-text {
            color: #c53030;
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .sub-text {
            font-size: 14px;
            color: #4a5568;
        }

        .solution-box {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .solution-tag {
            background: #ebf8ff;
            color: #2b6cb0;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }
    </style>
</head>

<body>

    <!-- Print Root Wrapper for Strict A4 Layout -->
    <div class="print-root">

        <!-- Page 1: Summary -->
        <div class="page">
            <div class="header">
                <h1>[{{ data.store.name }}] AIÂ·ê²€ìƒ‰ ë…¸ì¶œ ì§„ë‹¨ ë³´ê³ ì„œ</h1>
                <span class="date">{{ data.date }}</span>
            </div>

            <div class="section">
                <div class="section-title">ì§„ë‹¨ ìš”ì•½</div>

                {% if data.action_summary %}
                <div class="action-summary-container">
                    <div style="display: flex; gap: 16px; margin-bottom: 16px;">
                        <div style="font-size: 24px;">ğŸš¨</div>
                        <div>
                            <div class="warning-text">{{ data.action_summary.warning }}</div>
                            <div class="sub-text">ì´ ë¬¸ì œë¥¼ ë°©ì¹˜í•˜ë©´ ì ì¬ ê³ ê°ì„ ë†“ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
                        </div>
                    </div>

                    <div class="solution-box">
                        <div style="flex: 1;">
                            <div style="font-weight: 700; color: #2d3748; margin-bottom: 4px;">ğŸš€ ì˜¤ëŠ˜ ë°”ë¡œ í•´ê²°í•˜ê¸°</div>
                            <div style="font-size: 14px; color: #4a5568;">{{ data.action_summary.action }}</div>
                        </div>
                    </div>

                    <div style="margin-top: 12px; font-size: 13px; color: #718096; padding-left: 8px;">
                        ğŸ’¡ <strong>ì˜ˆìƒ íš¨ê³¼:</strong> {{ data.action_summary.benefit }}
                    </div>
                </div>
                {% endif %}

                <div class="summary-box">
                    <p class="summary-text">{{ data.analysis.map_summary }}</p>
                    <div style="height: 10px;"></div>
                    <p class="summary-text">{{ data.analysis.ai_summary }}</p>
                </div>
            </div>

            <div class="section">
                <div class="section-title">ì§€ë„ ì±„ë„ ë“±ë¡ í˜„í™©</div>
                <div class="grid-3">
                    {% for channel in data.analysis.map_statuses %}
                    <div class="card">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <h4>{{ channel.channel_name }}</h4>
                            <span class="status-badge bg-{{ channel.color.value }}">
                                {{ 'ë“±ë¡ë¨' if channel.is_registered else 'ë¯¸ë“±ë¡' }}
                            </span>
                        </div>
                        <p style="font-size: 12px; color: #64748b;">{{ channel.status_text }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="section">
                <div class="section-title">ë§¤ì¥ ì •ë³´ ì¼ì¹˜ ì—¬ë¶€</div>
                <table style="width: 100%;">
                    {% for item in data.analysis.consistency_results %}
                    <tr>
                        <td style="width: 30%; font-weight: 500; color: #475569;">{{ item.field_name }}</td>
                        <td style="text-align: right;">
                            <span style="font-weight: 600;"
                                class="{{ 'text-match' if item.status == 'Match' else 'text-mismatch' }}">{{
                                item.details }}</span>
                        </td>
                    </tr>
                    {% endfor %}
                </table>
            </div>

            <div class="footer">Page 1 / 4 â€¢ ReachCheck Analysis</div>
        </div>

        <!-- Page 2: AI Responses -->
        <div class="page">
            <div class="header">
                <h1>AIê°€ ë°”ë¼ë³¸ ìš°ë¦¬ ê°€ê²Œ</h1>
                <span class="date">{{ data.date }}</span>
            </div>

            <div class="section">
                <div class="section-title">AI ì—”ì§„ë³„ ìƒì„¸ ë‹µë³€ ë¶„ì„</div>
                <p style="font-size: 13px; color: #64748b; margin-bottom: 20px;">
                    ì‹¤ì œ AIì—ê²Œ ìš°ë¦¬ ë§¤ì¥ì— ëŒ€í•´ ë¬¼ì–´ë´¤ì„ ë•Œì˜ ë‹µë³€ì…ë‹ˆë‹¤. (ì‹¤ì œ ë°ì´í„° ê¸°ë°˜)
                </p>

                {% for engine, responses in data.analysis.ai_responses.items() %}
                <div class="card"
                    style="margin-bottom: 20px; page-break-inside: avoid; border-left: 4px solid #cbd5e1;">
                    <h3 style="font-size: 16px; margin-bottom: 12px; color: #334155;">{{ engine }}</h3>

                    {% for resp in responses %}
                    <div style="margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid #f1f5f9;">
                        <div style="font-size: 13px; font-weight: 700; color: #0052cc; margin-bottom: 6px;">Q. {{
                            resp.question }}</div>
                        <!-- Using pre-wrap logic via CSS on <p> to handle newlines -->
                        <p style="font-size: 13px; color: #334155; margin: 0;">{{ resp.answer }}</p>
                    </div>
                    {% endfor %}

                    {% if not responses %}
                    <p style="font-size: 13px; color: #ef4444; font-style: italic;">ì‘ë‹µì´ ì—†ê±°ë‚˜ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                    {% endif %}
                </div>
                {% endfor %}
            </div>

            <div class="footer">Page 2 / 4 â€¢ ReachCheck Analysis</div>
        </div>

        <!-- Page 3: Improvements -->
        <div class="page">
            <div class="header">
                <h1>ìš°ì„  ê°œì„  ê³¼ì œ (Top 3)</h1>
                <span class="date">{{ data.date }}</span>
            </div>

            <div class="section">
                <p style="font-size: 14px; color: #475569; margin-bottom: 20px;">
                    ê°€ì¥ ì ì€ ë…¸ë ¥ìœ¼ë¡œ ê°€ì¥ í° íš¨ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆëŠ” ê°œì„  í•­ëª©ì…ë‹ˆë‹¤.
                </p>

                {% for imp in data.analysis.improvements %}
                <div class="priority-item">
                    <div class="priority-rank">Priority {{ loop.index }}</div>
                    <div class="priority-title">{{ imp.title }}</div>
                    <p style="font-size: 14px; color: #334155; margin-bottom: 12px;">{{ imp.description }}</p>
                    <div style="background: #f8fafc; padding: 10px; border-radius: 4px; font-size: 12px;">
                        <span style="font-weight: 700; color: #0f172a;">Why it matters:</span>
                        <span style="color: #475569;">{{ imp.importance }}</span>
                        <!-- Assuming importance text is descriptive now or we map it -->
                    </div>
                </div>
                {% endfor %}
            </div>

            <div class="summary-box" style="background: #fffbeb; border-color: #fcd34d;">
                <p class="summary-text" style="color: #92400e; font-weight: 500;">
                    <strong>ğŸ’¡ Insight:</strong><br>
                    AI ë…¸ì¶œ ìµœì í™”ëŠ” 'ê¸°ê³„'ë¥¼ ìœ„í•œ ê²ƒì´ ì•„ë‹ˆë¼, ê²°êµ­ 'ê³ ê°'ì—ê²Œ ì˜¬ë°”ë¥¸ ì •ë³´ë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•œ ë…¸ë ¥ì…ë‹ˆë‹¤.
                </p>
            </div>

            <div class="footer">Page 3 / 4 â€¢ ReachCheck Analysis</div>
        </div>

        <!-- Page 4: Preview -->
        <div class="page">
            <div class="header">
                <h1>ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìµœì í™” ë¬¸ì¥</h1>
                <span class="date">{{ data.date }}</span>
            </div>

            <div class="section">
                <div class="section-title">AI í•œ ì¤„ ì†Œê°œ (One-Liner)</div>
                <p style="font-size: 14px; color: #475569; margin-bottom: 20px;">
                    ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ìƒì„¸ì„¤ëª…ì´ë‚˜ ì¸ìŠ¤íƒ€ê·¸ë¨ ì†Œê°œê¸€ì— ê·¸ëŒ€ë¡œ ë³µì‚¬í•´ì„œ ì‚¬ìš©í•˜ì„¸ìš”.
                </p>

                <div class="quote-box">
                    "{{ data.analysis.ai_intro_sentence }}"
                </div>

                <div style="text-align: right;">
                    <button
                        onclick="navigator.clipboard.writeText(`{{ data.analysis.ai_intro_sentence }}`).then(()=>alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'))"
                        style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; display: inline-block;">
                        ë¬¸ì¥ ë³µì‚¬í•˜ê¸°
                    </button>
                </div>
            </div>

            <div class="footer">Page 4 / 4 â€¢ ReachCheck Analysis</div>
        </div>

    </div> <!-- End Print Root -->
</body>

</html>