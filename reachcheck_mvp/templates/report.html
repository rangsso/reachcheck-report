<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>ReachCheck Report</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

        @page {
            size: A4;
            margin: 0;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 0;
            background: #525659;
            color: #333;
            -webkit-font-smoothing: antialiased;
            display: flex;
            flex-direction: column;
            align-items: center;
            word-break: keep-all;
        }

        .page {
            width: 210mm;
            height: 297mm;
            padding: 20mm 15mm;
            box-sizing: border-box;
            background: white;
            position: relative;
            margin-bottom: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
        }

        h1,
        h2,
        h3 {
            margin: 0 0 8px 0;
            word-break: keep-all;
        }

        p {
            margin: 0 0 4px 0;
            line-height: 1.4;
            word-break: keep-all;
            white-space: pre-wrap;
        }

        .header {
            border-bottom: 2px solid #1a1a1a;
            padding-bottom: 8px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 22px;
            font-weight: 700;
            color: #1a1a1a;
            margin: 0;
        }

        .header .date {
            font-size: 11px;
            color: #666;
        }

        .section {
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        .section-title {
            font-size: 15px;
            font-weight: 700;
            border-left: 4px solid #0052cc;
            padding-left: 8px;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        /* Slim Health Banner */
        .health-banner {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .health-banner-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .health-title {
            font-size: 14px;
            font-weight: 500;
            opacity: 0.9;
        }

        .health-score {
            font-size: 24px;
            font-weight: 800;
            color: #fff;
        }

        .health-banner-right {
            font-size: 13px;
            font-weight: 500;
            opacity: 0.95;
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 10px;
            border-radius: 12px;
        }

        /* Flex Row used for side-by-side blocks */
        .flex-row-2 {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            /* Increased margin for better separation */
        }

        .flex-col-1 {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* Status Grid */
        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
        }

        .mini-card {
            border: 1px solid #e2e8f0;
            padding: 12px;
            border-radius: 6px;
            background: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .mini-card h4 {
            font-size: 13px;
            margin: 0 0 4px 0;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .status-badge {
            padding: 3px 8px;
            border-radius: 12px;
            /* Pill shape */
            font-weight: 700;
            font-size: 11px;
            color: white;
        }

        .bg-green {
            background: #22c55e;
        }

        .bg-yellow {
            background: #eab308;
            color: #fff;
        }

        .bg-red {
            background: #ef4444;
        }

        /* Compact Table */
        .compact-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
            table-layout: fixed;
        }

        .compact-table th,
        .compact-table td {
            border: 1px solid #e2e8f0;
            padding: 6px 8px;
            text-align: left;
            overflow: visible;
            white-space: normal;
            word-break: keep-all;
        }

        .compact-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #475569;
        }

        .text-match {
            color: #16a34a;
            font-weight: 700;
        }

        .text-mismatch {
            color: #dc2626;
            font-weight: 700;
        }

        .footer {
            position: absolute;
            bottom: 10mm;
            left: 15mm;
            right: 15mm;
            text-align: center;
            font-size: 9px;
            color: #94a3b8;
            border-top: 1px solid #f1f5f9;
            padding-top: 6px;
        }

        .text-muted {
            color: #94a3b8 !important;
        }

        /* PRINT STYLES */
        @media print {
            @page {
                margin: 0;
                size: A4;
            }

            body {
                background: white;
            }
        }

        /* Mobile Responsiveness for Web Preview */
        @media screen and (max-width: 768px) {
            .page {
                width: 100%;
                padding: 10px;
                box-sizing: border-box;
                height: auto;
                min-height: 100vh;
                margin-bottom: 20px;
            }

            /* Stack AI Columns on Mobile */
            div[style*="grid-template-columns"] {
                grid-template-columns: 1fr !important;
            }
        }

        body {
            background: white;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .print-root {
            width: 210mm;
            /* Allow overflow context but restrict items */
        }

        .page {
            box-shadow: none;
            margin: 0;
            page-break-after: always;
            border: none;
            width: 210mm;
            height: 297mm;
            /* Force strict height per page */
            padding: 12mm 15mm;
            overflow: hidden;
            /* Prevent spill to next page */
            margin-bottom: 0 !important;
        }

        /* Helper for conditional borders (avoids Jinja in style attr) */
        .q-block-border {
            border-bottom: 1px solid #eee;
            padding-bottom: 12px;
        }

        /* Strict AI Answer Alignment */
        .ai-answer ul,
        .ai-answer li,
        .ai-answer p {
            text-align: left !important;
            padding-left: 0 !important;
            margin-left: 0 !important;
            list-style-position: inside !important;
            white-space: pre-line !important;
            /* Collapse runs of whitespace */
        }
    </style>
</head>

<body>

    <!-- Print Root Wrapper for Strict A4 Layout -->
    <div class="print-root">

        <!-- Page 1: Consolidated Summary -->
        <div class="page">
            <div class="header">
                <h1>[{{ data.store.name }}] AIÂ·ê²€ìƒ‰ ë…¸ì¶œ ì§„ë‹¨ ë¦¬í¬íŠ¸</h1>
                <span class="date">{{ data.date }}</span>
            </div>

            <!-- 1. Horizontal Health Banner -->
            <div style="margin-bottom: 15px;">
                <div class="health-banner" style="margin-bottom: 8px;">
                    <div class="health-banner-left">
                        <span class="health-title">ì‚¬ì¥ë‹˜ì˜ ë§¤ì¥ ê±´ê°• ì ìˆ˜</span>
                        <span class="health-score">{{ data.analysis.reachcheck_score }}ì </span>
                    </div>
                    <div class="health-banner-right">
                        ìƒìœ„ {{ 100 - data.analysis.reachcheck_score }}% ìˆ˜ì¤€ (ë§¤ìš° ê±´ê°•í•¨)
                    </div>
                </div>
                <!-- Health Score Rationale -->
                <div style="text-align: right; font-size: 11px; color: #64748b; font-weight: 500;">
                    * {{ data.analysis.score_rationale if data.analysis.score_rationale else 'ì ìˆ˜ ì‚°ì • ê¸°ì¤€: ì§€ë„ ì •ë³´ ì •í•©ì„±(30%) +
                    AI ì¸ì§€ë„(40%) + í‰ì (30%)' }}
                </div>
            </div>

            <!-- 2. Prescription Box (Full Width, Compact) -->
            <div
                style="margin-bottom: 20px; border: 1px solid #e2e8f0; border-radius: 8px; background: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.05); padding: 15px 20px; display: flex; align-items: flex-start; gap: 15px;">
                <span style="font-size: 32px;">ğŸ’Š</span>
                <div>
                    <div style="font-size: 13px; color: #64748b; font-weight: 700; margin-bottom: 4px;">ReachCheck ì²˜ë°©ì „
                        (Prescription)</div>
                    <div
                        style="font-size: 15px; color: #1e293b; font-weight: 500; line-height: 1.5; word-break: keep-all; white-space: pre-wrap;">
                        "{{ data.review_insights.prescription if data.review_insights and
                        data.review_insights.prescription else 'ì§„ë‹¨ ë°ì´í„°ê°€ ì¶©ë¶„í•˜ì§€ ì•Šì•„ ì²˜ë°©ì„ ë‚´ë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' }}"
                    </div>
                </div>
            </div>

            <!-- 3. Side-by-Side: Summary & Action Plan -->
            <div class="flex-row-2">
                <!-- Left: Diagnostic Summary -->
                <div class="flex-col-1">
                    <div class="section-title">ì§„ë‹¨ ìš”ì•½</div>
                    <div
                        style="background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; padding: 15px; height: 100%; font-size: 13px; line-height: 1.6; color: #475569; word-break: keep-all; white-space: normal;">
                        <p style="margin-bottom: 8px; word-break: keep-all;">{{ data.analysis.map_summary }}</p>
                        <p style="word-break: keep-all;">{{ data.analysis.ai_summary }}</p>
                    </div>
                </div>

                <!-- Right: Action Plan -->
                {% if data.action_summary %}
                <div class="flex-col-1">
                    <div class="section-title">ğŸš¨ ì˜¤ëŠ˜ ë°”ë¡œ í•´ê²°í•˜ê¸°</div>
                    <div
                        style="background: #fff5f5; border: 1px solid #feb2b2; border-radius: 8px; padding: 15px; height: 100%;">
                        <div style="color: #c53030; font-weight: 700; font-size: 14px; margin-bottom: 8px;">
                            {{ data.action_summary.warning }}
                        </div>
                        <div
                            style="background: #fff; border: 1px solid #fed7d7; padding: 8px 12px; border-radius: 6px; display: inline-block; margin-bottom: 8px;">
                            <span style="font-weight: 700; color: #2d3748; font-size: 13px;">ğŸš€ Solution:</span>
                            <span style="font-size: 13px; color: #4a5568;">{{ data.action_summary.action }}</span>
                        </div>
                        <div style="font-size: 11px; color: #718096;">
                            * ì˜ˆìƒ íš¨ê³¼: {{ data.action_summary.benefit }}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- 4. Map Channel Status (Simplified) -->
            <div class="section">
                <div class="section-title">ì§€ë„ ì±„ë„ ë“±ë¡ í˜„í™©</div>
                <div class="grid-3">
                    {% for channel in data.analysis.map_statuses %}
                    <div class="mini-card">
                        <h4 style="margin-bottom: 8px;">
                            {{ channel.channel_name }}
                        </h4>
                        <span class="status-badge {{ 'bg-green' if channel.is_registered else 'bg-red' }}">
                            {{ '[ì •ìƒ]' if channel.is_registered else '[ë¯¸ë“±ë¡]' }}
                        </span>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- 5. Consistency Table (Icons + Caption) -->
            <div class="section" style="flex-grow: 1;">
                <div class="section-title">ë°ì´í„° ì¶œì²˜ ë° ì •í•©ì„± (Consistency Check)</div>
                <table class="compact-table" style="font-size: 12px; margin-bottom: 8px;"> <!-- Slightly larger text -->
                    <thead>
                        <tr style="background-color: #f1f5f9; border-bottom: 2px solid #e2e8f0;">
                            <th style="width: 15%; padding: 10px;">í•­ëª©</th>
                            <th style="width: 25%; padding: 10px;">Naver (ê¸°ì¤€)</th>
                            <th style="width: 20%; padding: 10px;">Kakao</th>
                            <th style="width: 20%; padding: 10px;">Google</th>
                            <th style="width: 10%; padding: 10px; text-align: center;">ìƒíƒœ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if data.analysis.field_provenance and data.analysis.field_provenance.fields %}
                        {% for key, val in data.analysis.field_provenance.fields.items() %}
                        {% if key != 'category' %}
                        <tr style="border-bottom: 1px solid #f1f5f9;">
                            <td style="font-weight: 700; color: #475569; padding: 12px 10px;">{{ key|capitalize }}</td>
                            <td style="padding: 12px 10px;">{{ val.standard }}</td>
                            <td style="padding: 12px 10px;" class="{{ 'text-muted' if not val.sources.kakao }}">
                                {{ val.sources.kakao or '-' }}</td>
                            <td style="padding: 12px 10px;" class="{{ 'text-muted' if not val.sources.google }}">
                                {{ val.sources.google or '-' }}</td>
                            <td style="text-align: center; padding: 12px 10px;">
                                {% set ns = namespace(status='Unknown') %}
                                {% for cr in data.analysis.consistency_results %}
                                {% if cr.field_name|lower == key|lower %}
                                {% set ns.status = cr.status %}
                                {% endif %}
                                {% endfor %}

                                {% if ns.status == 'Match' %}
                                <span style="font-size: 16px;">âœ…</span>
                                {% else %}
                                <span style="font-size: 16px;">âš ï¸</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endif %}
                        {% endfor %}
                        {% endif %}
                    </tbody>
                </table>
                {% if data.analysis.field_provenance %}
                <div style="font-size: 10px; color: #94a3b8; text-align: right; margin-top: 4px;">
                    * Data Standard: {{ data.analysis.field_provenance.standard_source }} | Phone Source: {{
                    data.analysis.field_provenance.phone_source }}
                </div>
                {% endif %}
            </div>

            <div class="footer">Page 1 / 4 â€¢ ReachCheck Analysis</div>
        </div>

        <!-- Page 2: AI Responses -->
        <div class="page">
            <div class="header-prescription">
                <h2>AI ì—”ì§„ë³„ ìƒì„¸ ë‹µë³€ ë¶„ì„</h2>
            </div>

            <div class="section">
                {% if data.analysis.ai_responses.ChatGPT %}
                {% for i in range(data.analysis.ai_responses.ChatGPT|length) %}
                <!-- Question Block -->
                <div class="q-block {% if not loop.last %}q-block-border{% endif %}" style="margin-bottom: 12px;">
                    <!-- Common Question Header -->
                    <h3 style="font-size: 14px; font-weight: 700; color: #0f1ba0; margin: 0 0 8px 0; text-align: left;">
                        Q. {{ data.analysis.ai_responses.ChatGPT[i].question }}</h3>

                    <!-- Side-by-Side Grid (Equal Height) -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; align-items: stretch;">

                        <!-- ChatGPT Column -->
                        <div
                            style="background: #f9f9f9; padding: 12px; border-radius: 6px; border: 1px solid #e2e8f0; text-align: left; display: flex; flex-direction: column; height: 100%; box-sizing: border-box;">
                            <div
                                style="font-size: 11px; font-weight: 700; color: #10a37f; margin-bottom: 6px; display: flex; align-items: center; gap: 4px;">
                                ChatGPT
                                <span
                                    style="font-size: 9px; color: #64748b; background: #fff; padding: 1px 4px; border: 1px solid #cbd5e1; border-radius: 3px;">GPT-4o
                                    mini</span>
                            </div>
                            <div class="ai-answer"
                                style="font-size: 13px; color: #1e293b; line-height: 1.45; flex-grow: 1;">{{
                                data.analysis.ai_responses.ChatGPT[i].answer }}</div>
                        </div>

                        <!-- Gemini Column -->
                        <div
                            style="background: #f9f9f9; padding: 12px; border-radius: 6px; border: 1px solid #e2e8f0; text-align: left; display: flex; flex-direction: column; height: 100%; box-sizing: border-box;">
                            <div
                                style="font-size: 11px; font-weight: 700; color: #4285f4; margin-bottom: 6px; display: flex; align-items: center; gap: 4px;">
                                Gemini
                                <span
                                    style="font-size: 9px; color: #64748b; background: #fff; padding: 1px 4px; border: 1px solid #cbd5e1; border-radius: 3px;">Gemini
                                    2.0 Flash</span>
                            </div>
                            <!-- Single lined to prevent whitespace -->
                            <div class="ai-answer"
                                style="font-size: 13px; color: #1e293b; line-height: 1.45; flex-grow: 1;">{% if
                                data.analysis.ai_responses.Gemini and data.analysis.ai_responses.Gemini[i] %}{{
                                data.analysis.ai_responses.Gemini[i].answer }}{% else %}<p
                                    style="color: #94a3b8; font-size: 12px; text-align: center; margin: 0;">ë¶„ì„ ê²°ê³¼ ì—†ìŒ</p>
                                {% endif %}</div>
                        </div>

                    </div>
                </div>
                {% endfor %}
                {% else %}
                <div
                    style="display: flex; align-items: center; justify-content: center; height: 300px; color: #94a3b8; font-size: 14px; text-align: center;">
                    <p>AI ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.<br>(ì—°ë™ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”)</p>
                </div>
                {% endif %}
            </div>

            <div class="footer">Page 2 / 4 â€¢ ReachCheck Analysis</div>
        </div>

        <!-- Page 3: Review Insights -->
        <div class="page" style="page-break-before: always;">
            <div class="header-prescription">
                <h2>ê³ ê° ë¦¬ë·° ë¶„ì„</h2>
            </div>
            {% if data.review_insights and data.review_insights.review_count >= 5 %}
            <div class="section-title">ìì£¼ ì–¸ê¸‰ëœ í‘œí˜„ (ê¸ì •/íŠ¹ì§•)</div>
            <p style="font-size: 13px; color: #64748b; margin-bottom: 12px; margin-top: -10px;">
                ê³ ê°ë“¤ì´ ìš°ë¦¬ ë§¤ì¥ì„ ê²½í—˜í•  ë•Œ ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” ë‹¨ì–´ë“¤ì…ë‹ˆë‹¤.
                {% if data.review_insights.review_count < 20 %} <span style="color: #eab308; font-weight: bold;">
                    (ë°ì´í„°
                    ë¶€ì¡±ìœ¼ë¡œ ì°¸ê³ ìš©)</span>
                    {% endif %}
            </p>

            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 25px;">
                {% for phrase in data.review_insights.top_phrases %}
                <div
                    style="background: #eff6ff; border: 1px solid #bfdbfe; padding: 6px 12px; border-radius: 16px; font-size: 13px; color: #1e40af; display: flex; align-items: center;">
                    <span style="font-weight: 700;">{{ phrase.text }}</span>
                    <span style="font-size: 11px; color: #60a5fa; margin-left: 4px;">({{ phrase.count
                        }})</span>
                </div>
                {% endfor %}
            </div>

            <div class="section-title">ìì£¼ ì–¸ê¸‰ëœ ì•„ì‰¬ìš´ ì  (Pain Points)</div>
            <div
                style="background: #fff5f5; border: 1px solid #fed7d7; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                {% if data.review_insights.pain_phrases %}
                {% for phrase in data.review_insights.pain_phrases %}
                <div
                    style="display: flex; justify-content: space-between; margin-bottom: 8px; border-bottom: 1px dashed #feb2b2; padding-bottom: 4px;">
                    <span style="color: #c53030; font-weight: 600;">âš ï¸ {{ phrase.text }}</span>
                    <span style="color: #e53e3e;">{{ phrase.count }}íšŒ ì–¸ê¸‰</span>
                </div>
                {% endfor %}
                {% else %}
                <p style="color: #48bb78; font-weight: 600; text-align: center; margin: 0;">
                    âœ¨ ë°˜ë³µë˜ëŠ” ë¶€ì •ì ì¸ í”¼ë“œë°±ì´ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê´€ë¦¬ê°€ í›Œë¥­í•©ë‹ˆë‹¤!
                </p>
                {% endif %}
            </div>
            <!-- Pairings (New) -->
            <div class="section-title">ê°ì„± ì¡°í•© ë¶„ì„ (Sentiment Pairing)</div>
            <p style="font-size: 13px; color: #64748b; margin-bottom: 15px;">
                í‚¤ì›Œë“œì™€ ê°ì •ì´ ê²°í•©ëœ ì‹¤ì œ ê³ ê° ë°˜ì‘ì…ë‹ˆë‹¤. (íŒŒë‘: ê¸ì •, ë¹¨ê°•: ë¶€ì •)
            </p>
            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 30px;">
                {% if data.review_insights.pairings %}
                {% for p in data.review_insights.pairings %}
                {% if p.sentiment == 'negative' %}
                <div
                    style="background: #fef2f2; border: 1px solid #fecaca; padding: 6px 12px; border-radius: 16px; font-size: 13px; color: #b91c1c; display: flex; align-items: center;">
                    <span style="font-weight: 700;">{{ p.text }}</span>
                    <span style="font-size: 11px; opacity: 0.8; margin-left: 4px;">({{ p.count
                        }})</span>
                </div>
                {% else %}
                <div
                    style="background: #eff6ff; border: 1px solid #bfdbfe; padding: 6px 12px; border-radius: 16px; font-size: 13px; color: #1e40af; display: flex; align-items: center;">
                    <span style="font-weight: 700;">{{ p.text }}</span>
                    <span style="font-size: 11px; opacity: 0.8; margin-left: 4px;">({{ p.count
                        }})</span>
                </div>
                {% endif %}
                {% endfor %}
                {% else %}
                <div style="color: #94a3b8; font-size: 13px;">ë¶„ì„ëœ ê°ì„± ì¡°í•©ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                {% endif %}
            </div>

            {% else %}
            <div class="section-title" style="color: #64748b;">ë¦¬ë·° ë¶„ì„ ëŒ€ê¸° ì¤‘</div>
            <div
                style="background: #f8fafc; border: 1px dashed #cbd5e1; padding: 20px; border-radius: 8px; text-align: center; margin-bottom: 20px;">
                <p style="font-size: 14px; color: #475569; margin-bottom: 8px; font-weight: 600;">
                    í˜„ì¬ AIê°€ ë¦¬ë·° ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³  ë¶„ì„í•˜ëŠ” ë° ì‹œê°„ì´ ì§€ì—°ë˜ê³  ìˆìŠµë‹ˆë‹¤.
                </p>
                <p style="font-size: 13px; color: #64748b; margin: 0;">
                    ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì‹œê±°ë‚˜, ë°ì´í„°ê°€ ì¶©ë¶„íˆ ëª¨ì´ë©´ ìë™ìœ¼ë¡œ ë¶„ì„ ê²°ê³¼ê°€ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.<br>
                    (í˜„ì¬ ìˆ˜ì§‘ëœ ë¦¬ë·°: {{ data.review_insights.review_count if data.review_insights else 0 }}ê°œ)
                </p>
                <!-- Debug info moved to footer -->
            </div>
            {% endif %}

            <style>
                .card-positive {
                    background: #f0fdf4 !important;
                    color: #334155;
                    line-height: 1.6;
                }

                .card-negative {
                    background: #fff5f5 !important;
                    color: #334155;
                    line-height: 1.6;
                }

                .title-positive {
                    color: #166534;
                    font-weight: 700;
                    margin-bottom: 6px;
                }

                .title-negative {
                    color: #991b1b;
                    font-weight: 700;
                    margin-bottom: 6px;
                }
            </style>

            <div class="section-title">ëŒ€í‘œ ë¦¬ë·° ìƒ˜í”Œ</div>
            <div class="grid-3" style="display: grid !important; grid-template-columns: 1fr 1fr; gap: 12px;">
                {% if data.review_insights and data.review_insights.sample_reviews %}
                {% for sample in data.review_insights.sample_reviews %}
                <div
                    style="background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px; margin-bottom: 0; box-shadow: 0 1px 2px rgba(0,0,0,0.03); height: 110px; overflow: hidden; display: flex; flex-direction: column;">
                    <div style="display: flex; align-items: center; margin-bottom: 6px;">
                        <span style="font-size: 14px; margin-right: 6px;">ğŸ’¬</span>
                        <span style="font-size: 12px; font-weight: 700; color: #1e293b;">ë¦¬ë·° ë‚´ìš©</span>
                    </div>
                    <p
                        style="font-size: 12px; color: #334155; margin: 0; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;">
                        "{{ sample.text }}"
                    </p>
                </div>
                {% endfor %}
                {% else %}
                <div class="card">ìˆ˜ì§‘ëœ ìƒ˜í”Œ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                {% endif %}
            </div>

            <!-- Always Visible Debug Info -->
            <div
                style="margin-top: 20px; text-align: right; font-size: 11px; color: #94a3b8; border-top: 1px dotted #e2e8f0; padding-top: 10px;">
                * ìƒíƒœ ì½”ë“œ: {{ data.review_insights.debug_code if data.review_insights and
                data.review_insights.debug_code else 'System Init' }}
            </div>
        </div>

        <div class="footer">Page 3 / 5 â€¢ ReachCheck Analysis</div>
    </div>

    <!-- Page 4: Improvements (Moved) -->
    <div class="page">
        <div class="header">
            <h1>ìš°ì„  ê°œì„  ê³¼ì œ (Top 3)</h1>
            <span class="date">{{ data.date }}</span>
        </div>

        <div class="section">
            <p style="font-size: 14px; color: #475569; margin-bottom: 20px;">
                ê°€ì¥ ì ì€ ë…¸ë ¥ìœ¼ë¡œ ê°€ì¥ í° íš¨ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆëŠ” ê°œì„  í•­ëª©ì…ë‹ˆë‹¤.
            </p>

            {% for imp in data.analysis.improvements %}
            <div class="priority-item">
                <div class="priority-rank">Priority {{ loop.index }}</div>
                <div class="priority-title">{{ imp.title }}</div>
                <p style="font-size: 14px; color: #334155; margin-bottom: 12px;">{{ imp.description }}
                </p>
                <div style="background: #f8fafc; padding: 10px; border-radius: 4px; font-size: 12px;">
                    <span style="font-weight: 700; color: #0f172a;">Why it matters:</span>
                    <span style="color: #475569;">{{ imp.importance }}</span>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="summary-box" style="background: #fffbeb; border-color: #fcd34d;">
            <p class="summary-text" style="color: #92400e; font-weight: 500;">
                <strong>ğŸ’¡ Insight:</strong><br>
                AI ë…¸ì¶œ ìµœì í™”ëŠ” 'ê¸°ê³„'ë¥¼ ìœ„í•œ ê²ƒì´ ì•„ë‹ˆë¼, ê²°êµ­ 'ê³ ê°'ì—ê²Œ ì˜¬ë°”ë¥¸ ì •ë³´ë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•œ ë…¸ë ¥ì…ë‹ˆë‹¤.
            </p>
        </div>

        <div class="footer">Page 4 / 5 â€¢ ReachCheck Analysis</div>
    </div>

    <!-- Page 5: Preview (Moved) -->
    <div class="page">
        <div class="header">
            <h1>ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìµœì í™” ë¬¸ì¥</h1>
            <span class="date">{{ data.date }}</span>
        </div>

        <div class="section">
            <div class="section-title">AI í•œ ì¤„ ì†Œê°œ (One-Liner)</div>
            <p style="font-size: 14px; color: #475569; margin-bottom: 20px;">
                ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ìƒì„¸ì„¤ëª…ì´ë‚˜ ì¸ìŠ¤íƒ€ê·¸ë¨ ì†Œê°œê¸€ì— ê·¸ëŒ€ë¡œ ë³µì‚¬í•´ì„œ ì‚¬ìš©í•˜ì„¸ìš”.
            </p>

            <div class="quote-box">
                "{{ data.analysis.ai_intro_sentence }}"
            </div>

            <div style="text-align: right;">
                <button
                    onclick="navigator.clipboard.writeText(`{{ data.analysis.ai_intro_sentence }}`).then(()=>alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'))"
                    style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; display: inline-block;">
                    ë¬¸ì¥ ë³µì‚¬í•˜ê¸°
                </button>
            </div>
        </div>

        <div class="footer">Page 5 / 5 â€¢ ReachCheck Analysis</div>
    </div>

    </div> <!-- End Print Root -->
</body>

</html>